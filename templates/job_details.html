<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>{{ job.job_title }} | CareerConnect</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN"
      crossorigin="anonymous"
    />
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}" />
  </head>
  <body style="background: #f5f7fb;">
    <div class="container py-4">
      <div class="d-flex justify-content-between align-items-center mb-3">
        <h3>Job Details</h3>
        <div>
          {% if session.role == 'seeker' %}
            <a class="btn btn-outline-primary" href="{{ url_for('seeker_dashboard') }}">Back to Dashboard</a>
          {% elif session.role == 'recruiter' %}
            <a class="btn btn-outline-primary" href="{{ url_for('recruiter_dashboard') }}">Back to Dashboard</a>
          {% endif %}
        </div>
      </div>

      <div class="row g-4">
        <!-- Job Info Sidebar -->
        <div class="col-lg-4">
          <div class="card shadow-sm">
            <div class="card-body">
              <div class="d-flex align-items-center mb-3">
                <div class="rounded-circle bg-primary bg-opacity-10 text-primary d-flex align-items-center justify-content-center" style="width: 48px; height: 48px; font-weight: 700;">
                  {{ job.company_name[:2]|upper if job.company_name else 'CO' }}
                </div>
                <div class="ms-3">
                  <h5 class="mb-0">{{ job.company_name or 'Company' }}</h5>
                  <small class="text-muted">{{ job.industry_type or 'Industry' }}</small>
                </div>
              </div>
              
              <hr />
              
              <h6 class="mb-2">Job Information</h6>
              <ul class="list-unstyled mb-3 small">
                <li class="mb-2"><strong>Location:</strong> {{ job.job_location or '-' }}</li>
                <li class="mb-2"><strong>Type:</strong> {{ job.employment_type or '-' }}</li>
                <li class="mb-2"><strong>Experience:</strong> {{ job.experience_level or '-' }}</li>
                {% if job.salary_range %}
                <li class="mb-2"><strong>Salary:</strong> {{ job.salary_range }}</li>
                {% endif %}
                <li class="mb-2"><strong>Posted:</strong> {{ job.created_at[:10] if job.created_at else '-' }}</li>
              </ul>

              <hr />

              {% if session.role == 'seeker' %}
              <div class="d-grid gap-2">
                {% if has_applied %}
                  <button class="btn btn-success" disabled>Applied</button>
                {% else %}
                  <form method="POST" action="{{ url_for('apply_job', job_id=job.id) }}">
                    <button type="submit" class="btn btn-primary w-100">Apply Now</button>
                  </form>
                {% endif %}
                
                {% if is_saved %}
                  <button class="btn btn-warning save-btn" data-job-id="{{ job.id }}">Saved</button>
                {% else %}
                  <button class="btn btn-outline-secondary save-btn" data-job-id="{{ job.id }}">Save Job</button>
                {% endif %}
              </div>
              {% endif %}
            </div>
          </div>
        </div>

        <!-- Job Description -->
        <div class="col-lg-8">
          <div class="card shadow-sm">
            <div class="card-body">
              <h2 class="mb-3">{{ job.job_title }}</h2>
              
              <div class="mb-4">
                <span class="badge bg-primary me-2">{{ job.employment_type }}</span>
                <span class="badge bg-info text-dark me-2">{{ job.experience_level }}</span>
                <span class="badge bg-secondary">{{ job.job_location }}</span>
              </div>

              <hr />

              <h5 class="mb-3">Job Description</h5>
              <p style="white-space: pre-wrap;">{{ job.job_description }}</p>

              <hr />

              <h5 class="mb-3">Required Skills</h5>
              <div class="d-flex flex-wrap gap-2">
                {% if job.required_skills %}
                  {% for skill in job.required_skills.split(',') %}
                    <span class="badge bg-light text-dark border">{{ skill.strip() }}</span>
                  {% endfor %}
                {% else %}
                  <p class="text-muted">No specific skills listed</p>
                {% endif %}
              </div>

              {% if job.salary_range %}
              <hr />
              <h5 class="mb-3">Salary Range</h5>
              <p class="text-primary fw-bold">{{ job.salary_range }}</p>
              {% endif %}
            </div>
          </div>
        </div>
      </div>
    </div>

    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL"
      crossorigin="anonymous"
    ></script>

    {% if session.role == 'seeker' %}
    <script>
      // Handle save job button
      const saveBtn = document.querySelector('.save-btn');
      if (saveBtn) {
        saveBtn.addEventListener('click', function(){
          const jobId = saveBtn.dataset.jobId;
          const wasSaved = saveBtn.classList.contains('btn-warning');

          saveBtn.disabled = true;
          const originalText = saveBtn.innerText;
          saveBtn.innerText = wasSaved ? 'Unsaving...' : 'Saving...';

          fetch(`/seeker/save_job/${jobId}`, {
            method: 'POST',
            headers: {
              'X-Requested-With': 'XMLHttpRequest'
            }
          })
          .then(resp => resp.json())
          .then(data => {
            if (data.status === 'saved') {
              saveBtn.classList.remove('btn-outline-secondary');
              saveBtn.classList.add('btn-warning');
              saveBtn.innerText = 'Saved';
            } else if (data.status === 'unsaved') {
              saveBtn.classList.remove('btn-warning');
              saveBtn.classList.add('btn-outline-secondary');
              saveBtn.innerText = 'Save Job';
            }
            saveBtn.disabled = false;
          })
          .catch(err => {
            saveBtn.disabled = false;
            saveBtn.innerText = originalText;
            alert('Error saving job. Please try again.');
          });
        });
      }
    </script>
    {% endif %}
  </body>
</html>
